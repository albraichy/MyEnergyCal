<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>مخطط السعرات الذكي</title>
  <style>
    :root{
      color-scheme: light dark;
      --bg:#0b0f14; --grad:#121826; --card:#121926; --text:#e6eef8;
      --muted:#94a3b8; --accent:#7dd3fc; --shadow:0 6px 22px rgba(0,0,0,.35);
      --radius:14px; --border:#1f2a3c; --topbar-bg:rgba(18,25,38,.9);
      --input-bg:#0f172a; --input-border:#1f2937; --subcard-bg:#0c1424;
      
      /* الألوان */
      --c-red:    #ef4444; 
      --c-orange: #f97316; 
      --c-yellow: #eab308; 
      --c-green:  #22c55e; 
      --c-teal:   #14b8a6; 
      --c-cyan:   #0ea5e9; 
      --c-blue:   #3b82f6; 
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f3f4f6; --grad:#e5e7eb; --card:#ffffff; --text:#020617;
        --muted:#6b7280; --accent:#0ea5e9; --shadow:0 6px 22px rgba(15,23,42,.18);
        --border:#d1d5db; --topbar-bg:rgba(248,250,252,.9);
        --input-bg:#f9fafb; --input-border:#d1d5db; --subcard-bg:#f9fafb;
      }
    }

    *{box-sizing:border-box}
    html{height:100%;background:var(--bg)}
    body{
      min-height:100dvh; margin:0; font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
      color:var(--text); background:linear-gradient(180deg,var(--bg) 0%, var(--grad) 100%);
      padding-top: calc(112px + env(safe-area-inset-top)); padding-bottom: 32px;
      display:flex; flex-direction:column;
    }
    .topbar{
      position:fixed; inset:0 0 auto 0; height:112px;
      background:var(--topbar-bg); backdrop-filter:blur(6px);
      display:flex; align-items:center; justify-content:center;
      border-bottom:1px solid var(--border); z-index:50;
    }
    .top-inner{width:100%; max-width:860px; display:grid; justify-items:center; gap:8px}
    .title{margin:0; font-size:20px; text-align:center}
    
    .lang{display:flex; gap:0; border:1px solid var(--input-border); border-radius:10px; overflow:hidden; direction: ltr;}
    .lang button{
      border:0; background:var(--input-bg); color:var(--text);
      padding:6px 14px; cursor:pointer; font-weight:700; min-width:40px;
    }
    .lang button.active{background:var(--accent); color:#001018;}

    .wrap{width:100%; max-width:860px; margin:0 auto; display:grid; gap:16px; padding:0 12px; flex:1}
    .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px}
    
    /* تنسيق الإدخال */
    .input-grid{display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:12px}
    .field{display:flex; flex-direction:column; gap:6px; align-items:center}
    .field-full{grid-column: span 4;}

    label{font-size:13px; color:var(--muted)}
    input[type="text"], select{
      width:100%; text-align:center;
      border:1px solid var(--input-border); background:var(--input-bg); color:var(--text);
      padding:12px 8px; border-radius:10px; font-size:15px; outline:none; direction:ltr;
    }
    .btn{
      border:0; border-radius:12px; background:var(--accent); color:#001018;
      font-weight:800; padding:12px 18px; cursor:pointer; width:100%; margin-top:10px;
      transition: background 0.3s ease;
    }
    .btn:hover{filter: brightness(1.1);}
    
    /* النتائج */
    .result{text-align:center; display:none; gap:12px; padding:16px; border-radius:var(--radius);}
    .result.show{display:grid;}
    
    .rbox{
      background:var(--subcard-bg); padding:10px; border-radius:12px; border:1px solid var(--border);
    }
    .rtitle{margin:0 0 6px; font-size:13px; color:var(--muted);}
    
    /* المسطرة */
    .goal-slider-container { padding: 10px 0; display:flex; flex-direction: column; gap: 8px; }
    .goal-label {
      font-size: 20px; font-weight: 800; margin-bottom: 4px;
      transition: color 0.3s ease;
    }
    .timeline-label {
        font-size: 14px; color: var(--text); font-weight: 600; opacity: 0.8; direction: rtl; unicode-bidi: embed;
    }
    
    input[type=range] {
      -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer;
    }
    /* التدرج اللوني: اليسار (أزرق) -> اليمين (أحمر) */
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%; height: 10px; border-radius: 5px;
      background: linear-gradient(90deg, 
        var(--c-blue) 0%,   /* يسار */
        var(--c-cyan) 20%,  
        var(--c-teal) 35%,  
        var(--c-green) 50%, /* وسط */
        var(--c-yellow) 65%,
        var(--c-orange) 80%,
        var(--c-red) 100%   /* يمين */
      );
    }
    input[type=range]::-webkit-slider-thumb {
      height: 22px; width: 22px; border-radius: 50%; background: #fff; border: 2px solid var(--muted);
      -webkit-appearance: none; margin-top: -6px; box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    /* النصوص تحت المسطرة */
    .scale-labels {
      display: flex; justify-content: space-between; font-size: 11px; color: var(--muted); margin-top: 0px;
      direction: rtl; /* عشان العنصر الأول يكون يمين */
    }
    /* بدون Order وبدون تعقيد: الأول يمين، الأخير يسار */


    /* باقي البطاقات */
    .target-box {
      border: 1px solid var(--accent); background: rgba(14, 165, 233, 0.05);
      padding: 16px; border-radius: 12px; margin-top: 0;
    }
    .target-val { font-size: 26px; font-weight: 800; color: var(--accent); }
    
    .macro-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
    }
    .mbox {
      background: var(--subcard-bg); border: 1px solid var(--border);
      border-radius: 10px; padding: 12px 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap:4px;
    }
    .mbox-label { font-size: 12px; color: var(--muted); }
    .mbox-val { font-size: 15px; font-weight: 800; white-space: nowrap; }
    .mbox-sub { font-size: 11px; color: var(--muted); opacity: 0.8;}

    .wbox {
      background: var(--subcard-bg); border: 1px solid var(--border);
      border-radius: 10px; padding: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .wbox-val { font-size: 16px; font-weight: 700; }

    .range-flex {
        display: flex; align-items: center; justify-content: center; gap: 6px; direction: inherit;
    }
    html[dir="rtl"] .range-flex { flex-direction: row; }
    html[dir="ltr"] .range-flex { flex-direction: row; }

    .val-num { direction: ltr; unicode-bidi: embed; }
    .arrow { font-family: system-ui, sans-serif; font-weight: 700; color: var(--muted); }

    footer{text-align:center; padding:20px; font-size:12px; color:var(--muted);}
  </style>
</head>
<body>

  <div class="topbar">
    <div class="top-inner">
      <h1 class="title" id="title">مخطط السعرات الذكي</h1>
      <div class="lang">
        <button id="btn-en">E</button>
        <button id="btn-ar" class="active">ع</button>
      </div>
    </div>
  </div>

  <main class="wrap">
    <section class="card">
      <div class="input-grid">
        <div class="field">
          <label id="lab-gender">الجنس</label>
          <select id="gender"><option value="male">ذكر</option><option value="female">أنثى</option></select>
        </div>
        <div class="field"><label id="lab-age">العمر</label><input id="age" type="text" inputmode="decimal"></div>
        <div class="field"><label id="lab-weight">الوزن (kg)</label><input id="weight" type="text" inputmode="decimal"></div>
        <div class="field"><label id="lab-height">الطول (cm)</label><input id="height" type="text" inputmode="decimal"></div>
        <div class="field field-full">
            <button id="calc" class="btn">احسب</button>
        </div>
      </div>
    </section>

    <section class="card result" id="result-card">
      
      <div class="rbox">
        <h3 class="rtitle" id="msg-maintenance">سعرات المحافظة</h3>
        <div class="rvalue val-num" style="font-size:24px; font-weight:700" id="tdee-val">—</div>
      </div>

      <div class="goal-slider-container">
        <div class="goal-label" id="selected-goal">Maintain</div>
        <input type="range" id="goal-slider" min="0" max="6" step="1" value="3">
        <div class="scale-labels" id="slider-labels">
            <span>تنشيف</span>
            <span>محافظة</span>
            <span>تضخيم</span>
        </div>
        <div class="timeline-label" id="val-timeline">—</div>
      </div>

      <div class="target-box">
        <div class="rtitle" id="lab-target-cals">نطاق السعرات</div>
        <div class="target-val" id="val-target-cals">—</div>
      </div>

      <div class="macro-grid">
        <div class="mbox">
            <span class="mbox-label" id="lab-prot">بروتين</span>
            <span class="mbox-val val-num" id="val-prot">—</span>
            <span class="mbox-sub val-num" id="sub-prot">حد أدنى</span>
        </div>
        <div class="mbox">
            <span class="mbox-label" id="lab-fat">دهون</span>
            <span class="mbox-val val-num" id="val-fat">—</span>
        </div>
        <div class="mbox">
            <span class="mbox-label" id="lab-carb">كارب</span>
            <span class="mbox-val" id="val-carb">—</span>
        </div>
      </div>

      <div class="wbox">
          <div class="rtitle" id="lab-weight-change">التغير المتوقع</div>
          <div class="wbox-val" id="val-weight-change">—</div>
      </div>
      
    </section>
  </main>
  
  <footer>
    <div id="copyright">© 2025 — Smart Planner</div>
  </footer>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  let currentLang = 'ar';
  let tdeeGlobal = 0;
  let weightGlobal = 0;

  const goalsData = [
    { id: 'rapid',  en:'Rapid Cut', ar:'تنشيف قاسي', c_min:-0.50, c_max:-0.25, p:2.0, f_factor:0.5,  w_pct:[-0.0125, -0.0175], timeEn:'2 → 8 weeks', timeAr:'٢ ← ٨ أسابيع' },
    { id: 'cut',    en:'Cutting',   ar:'تنشيف',     c_min:-0.25, c_max:-0.10, p:1.9, f_factor:0.6,  w_pct:[-0.005, -0.0125],  timeEn:'8 → 16 weeks', timeAr:'٨ ← ١٦ أسبوع' },
    { id: 'recomp', en:'Recomp.',   ar:'إعادة تشكيل', c_min:-0.10, c_max:-0.05, p:1.8, f_factor:0.65, w_pct:[-0.0025, -0.005], timeEn:'3 → 6 months', timeAr:'٣ ← ٦ أشهر' },
    { id: 'maint',  en:'Maintain',  ar:'محافظة',    c_min:-0.05, c_max:0.00,  p:1.7, f_factor:0.7,  w_pct:[0.0025, -0.0025],  timeEn:'Lifelong',    timeAr:'نمط حياة' },
    { id: 'gain',   en:'MainGain',  ar:'بناء محافظ', c_min:0.00,  c_max:0.05,  p:1.6, f_factor:0.75, w_pct:[0, 0.0025],      timeEn:'6 → 12 months',timeAr:'٦ ← ١٢ شهر' },
    { id: 'lean',   en:'Lean Bulk', ar:'تضخيم صافي',c_min:0.05,  c_max:0.10,  p:1.5, f_factor:0.8,  w_pct:[0.0025, 0.005],  timeEn:'4 → 9 months', timeAr:'٤ ← ٩ أشهر' },
    { id: 'bulk',   en:'Bulking',   ar:'تضخيم',     c_min:0.10,  c_max:0.25,  p:1.4, f_factor:0.9,  w_pct:[0.005, 0.01],    timeEn:'3 → 5 months', timeAr:'٣ ← ٥ أشهر' }
  ];

  const goalColors = [
    'var(--c-red)',    // 0: تنشيف قاسي (يمين)
    'var(--c-orange)', // 1: تنشيف
    'var(--c-yellow)', // 2: إعادة تشكيل
    'var(--c-green)',  // 3: محافظة (وسط)
    'var(--c-teal)',   // 4: بناء محافظ
    'var(--c-cyan)',   // 5: تضخيم صافي
    'var(--c-blue)'    // 6: تضخيم (يسار)
  ];

  const i18n = {
    ar: {
      dir:"rtl", title:"مخطط السعرات الذكي", gender:"الجنس", age:"العمر", weight:"الوزن (kg)", height:"الطول (cm)", calc:"احسب",
      maintT:"سعرات المحافظة", target:"نطاق السعرات", wChange:"التغير المتوقع",
      p:"بروتين", f:"دهون", c:"كارب", pSub:"حد أدنى",
      // هنا الترتيب حسب ظهورهم في HTML (من اليمين لليسار في RTL)
      sl_1:"تنشيف", sl_2:"محافظة", sl_3:"تضخيم",
      rights:"© 2025 — جميع الحقوق محفوظة",
    },
    en: {
      dir:"ltr", title:"Smart Calorie Planner", gender:"Gender", age:"Age", weight:"Weight (kg)", height:"Height (cm)", calc:"Calculate",
      maintT:"Maintenance TDEE", target:"Calorie Range", wChange:"Exp. Change",
      p:"Protein", f:"Fat", c:"Carbs", pSub:"Minimum",
      sl_1:"Cut", sl_2:"Maintain", sl_3:"Bulk", 
      rights:"© 2025 — Smart Planner",
    }
  };

  function setLang(lang){
    currentLang = lang;
    const t = i18n[lang];
    document.documentElement.lang = lang; 
    document.documentElement.dir = t.dir;
    $('title').textContent = t.title;
    $('lab-gender').textContent = t.gender;
    $('lab-age').textContent = t.age;
    $('lab-weight').textContent = t.weight;
    $('lab-height').textContent = t.height;
    $('calc').textContent = t.calc;
    $('msg-maintenance').textContent = t.maintT;
    $('lab-target-cals').textContent = t.target;
    $('lab-weight-change').textContent = t.wChange;
    $('lab-prot').textContent = t.p;
    $('lab-fat').textContent = t.f;
    $('lab-carb').textContent = t.c;
    $('sub-prot').textContent = t.pSub;
    $('copyright').textContent = t.rights;


    const sl = $('slider-labels');
    // تعيين النصوص مباشرة بدون لف ودوران
    // العنصر الأول = يمين
    sl.children[0].textContent = t.sl_1;
    // العنصر الثاني = وسط
    sl.children[1].textContent = t.sl_2;
    // العنصر الثالث = يسار
    sl.children[2].textContent = t.sl_3;


    $('btn-ar').classList.toggle('active', lang==='ar');
    $('btn-en').classList.toggle('active', lang==='en');
    
    updatePlan();
  }

  function normalize(str){
    return str.replace(/[٠-٩]/g, d => '٠١٢٣٤٥٦٧٨٩'.indexOf(d)).replace(/[^0-9.]/g,'');
  }

  function formatRangeHTML(val1, val2, unit){
    let min = Math.min(val1, val2);
    let max = Math.max(val1, val2);
    const arrow = currentLang === 'ar' ? '←' : '→';
    return `
        <div class="range-flex">
            <span class="val-num">${min}</span>
            <span class="arrow">${arrow}</span>
            <span class="val-num">${max}${unit ? '<small>'+unit+'</small>' : ''}</span>
        </div>
    `;
  }
  
  function formatWeightHTML(val1, val2){
    const abs1 = Math.abs(val1);
    const abs2 = Math.abs(val2);
    let startVal, endVal;
    if(abs1 < abs2) { startVal = val1; endVal = val2; }
    else { startVal = val2; endVal = val1; }
    
    const sStr = (startVal > 0 ? "+" : "") + startVal.toFixed(2);
    const eStr = (endVal > 0 ? "+" : "") + endVal.toFixed(2);
    const arrow = currentLang === 'ar' ? '←' : '→';

    if(abs1 < 0.01 && abs2 < 0.01) return `<span class="val-num">~ 0 kg</span>`;

    return `
        <div class="range-flex">
            <span class="val-num">${sStr}</span>
            <span class="arrow">${arrow}</span>
            <span class="val-num">${eStr} kg</span>
        </div>
    `;
  }

  function calculateTDEE(){
    const age = parseFloat(normalize($('age').value));
    const w = parseFloat(normalize($('weight').value));
    const h = parseFloat(normalize($('height').value));
    const g = $('gender').value;

    if(!age || !w || !h) return;
    weightGlobal = w;
    
    let base = (10*w) + (6.25*h) - (5*age) + (g==='male'?5:-161);
    tdeeGlobal = Math.round(base * 1.35);

    $('tdee-val').textContent = tdeeGlobal;
    $('result-card').classList.add('show');
    $('goal-slider').value = 3;
    updatePlan();
  }

  function updatePlan(){
    if(!tdeeGlobal) return;
    
    let idx = parseInt($('goal-slider').value);
    const data = goalsData[idx];

    // 1. Color & Title
    const lbl = $('selected-goal');
    lbl.textContent = currentLang === 'ar' ? data.ar : data.en;
    
    if(goalColors[idx]) {
        lbl.style.color = goalColors[idx];
    } else {
        lbl.style.color = 'var(--text)';
    }

    // 2. Timeline
    $('val-timeline').textContent = currentLang === 'ar' ? data.timeAr : data.timeEn;
    if(currentLang === 'ar') $('val-timeline').style.direction = 'rtl';

    // 3. Calories Range
    const c1 = Math.round((tdeeGlobal * (1 + data.c_min))/50)*50;
    const c2 = Math.round((tdeeGlobal * (1 + data.c_max))/50)*50;
    
    if(c1 === c2) $('val-target-cals').textContent = c1;
    else $('val-target-cals').innerHTML = formatRangeHTML(c1, c2, "");

    // 4. Weight Change
    const w1 = weightGlobal * data.w_pct[0];
    const w2 = weightGlobal * data.w_pct[1];
    $('val-weight-change').innerHTML = formatWeightHTML(w1, w2);

    // 5. Macros
    const prot = Math.round(weightGlobal * data.p);
    $('val-prot').textContent = prot + "g";

    const fatVal = Math.round(weightGlobal * data.f_factor);
    $('val-fat').textContent = fatVal + "g";

    const protCals = prot * 4;
    const fatCals = fatVal * 9;
    const fixedCals = protCals + fatCals;

    let cLow = Math.round((Math.min(c1, c2) - fixedCals) / 4);
    if(cLow < 0) cLow = 0;

    let cHigh = Math.round((Math.max(c1, c2) - fixedCals) / 4);
    if(cHigh < 0) cHigh = 0;
    
    $('val-carb').innerHTML = formatRangeHTML(cLow, cHigh, "g");
  }

  $('calc').addEventListener('click', calculateTDEE);
  $('goal-slider').addEventListener('input', updatePlan);
  $('btn-ar').addEventListener('click', ()=>setLang('ar'));
  $('btn-en').addEventListener('click', ()=>setLang('en'));

  setLang('ar');
})();
</script>
</body>
</html>
